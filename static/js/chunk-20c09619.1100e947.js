(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-20c09619"],{1:function(e,t){},"1c7a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("upload-excel-component",{ref:"uploadBox",attrs:{"on-success":e.handleSuccess,"before-upload":e.beforeUpload},on:{sureUpload:e.sureUpload}}),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.list,border:"","highlight-current-row":""}},e._l(e.tableHeader,(function(e){return a("el-table-column",{key:e,attrs:{prop:e,label:e}})})),1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{"update:page":function(t){return e.$set(e.listQuery,"page",t)},"update:limit":function(t){return e.$set(e.listQuery,"limit",t)},pagination:e.getList}})],1)},i=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("input",{ref:"excel-upload-input",staticClass:"excel-upload-input",attrs:{type:"file",accept:".xlsx, .xls"},on:{change:e.handleClick}}),e._v(" "),a("div",{staticClass:"drop",on:{drop:e.handleDrop,dragover:e.handleDragover,dragenter:e.handleDragover}},[e._v("\n    拖放或上传文件\n    "),a("el-button",{staticStyle:{"margin-left":"16px"},attrs:{loading:e.loading,size:"mini",type:"primary"},on:{click:e.handleUpload}},[e._v("\n      浏览\n    ")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"16px"},attrs:{size:"mini",type:"success"},on:{click:function(t){return e.$emit("sureUpload")}}},[e._v("\n      确认上传\n    ")])],1)])},s=[],l=(a("7f7f"),a("1146")),r=a.n(l),u={props:{beforeUpload:Function,onSuccess:Function},data:function(){return{loading:!1,excelData:{header:null,results:null},fileAddress:null}},methods:{generateData:function(e){var t=e.header,a=e.results;this.excelData.header=t,this.excelData.results=a,this.onSuccess&&this.onSuccess(this.excelData)},handleDrop:function(e){if(e.stopPropagation(),e.preventDefault(),!this.loading){var t=e.dataTransfer.files;if(1===t.length){var a=t[0];if(!this.isExcel(a))return this.$message.error("请上传xls格式"),!1;this.upload(a),e.stopPropagation(),e.preventDefault()}else this.$message.error("Only support uploading one file!")}},handleDragover:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleUpload:function(){this.$refs["excel-upload-input"].click()},handleClick:function(e){this.fileAddress=e.target.files[0];var t=e.target.files,a=t[0];a&&this.upload(a)},upload:function(e){if(this.$refs["excel-upload-input"].value=null,this.beforeUpload){var t=this.beforeUpload(e);t&&this.readerData(e)}else this.readerData(e)},readerData:function(e){var t=this;return this.loading=!0,new Promise((function(a,n){var i=new FileReader;i.onload=function(e){var n=e.target.result,i=r.a.read(n,{type:"array"}),o=i.SheetNames[0],s=i.Sheets[o],l=t.getHeaderRow(s),u=r.a.utils.sheet_to_json(s);t.generateData({header:l,results:u}),t.loading=!1,a()},i.readAsArrayBuffer(e)}))},getHeaderRow:function(e){var t,a=[],n=r.a.utils.decode_range(e["!ref"]),i=n.s.r;for(t=n.s.c;t<=n.e.c;++t){var o=e[r.a.utils.encode_cell({c:t,r:i})],s="UNKNOWN "+t;o&&o.t&&(s=r.a.utils.format_cell(o)),a.push(s)}return a},isExcel:function(e){return/\.(xls|csv)$/.test(e.name)}}},c=u,d=(a("ea2c"),a("2877")),p=Object(d["a"])(c,o,s,!1,null,"2bad1e9c",null),f=p.exports,g=a("333d"),h=a("5f87"),m={name:"importEnrollment",components:{UploadExcelComponent:f,Pagination:g["a"]},data:function(){return{tableData:[],tableHeader:[],tableKey:0,list:null,total:0,listLoading:!0,listQuery:{page:1,limit:8},fileAddress:null,uploading:!1}},mounted:function(){var e=this.$route.params.contestId;console.log("赛事id为"+e)},methods:{sureUpload:function(){if(console.log("emit触发到这,开始上传"),null!=this.fileAddress)if(this.uploading)this.$message({message:"请勿重复上传",type:"fail"});else{this.uploading=!0;var e=new FormData;e.append("file",this.fileAddress);var t={headers:{"Content-Type":"multipart/form-data",Authorization:Object(h["a"])()}},a=this,n=this.$route.params.contestId;this.globalAxios.post("http://localhost:443/contest/enrollment/import/"+n,e,t).then((function(e){console.log(e.data),200==e.data.code?(a.$message({message:"上传成功",type:"success"}),setTimeout((function(){var e=a.$route.params.contestId;a.$router.push("/organizer/contest/achievement/"+e)}),2500)):(a.uploading=!1,a.$message({message:e.data.message,type:"fail"}))})).catch((function(e){a.uploading=!1,a.$message({message:"上传失败",type:"fail"})}))}else this.$message({message:"请选择文件",type:"fail"})},getList:function(){console.log("进入分页");var e=this.listQuery.page-1,t=this.listQuery.limit,a=this.tableData.length;console.log("page",e),console.log("limie",t),console.log("total",a),this.total=this.tableData.length,this.list=this.tableData.slice(e*t,e*t+t)},beforeUpload:function(e){var t=e.size/1024/1024<15;return!!t||(this.$message({message:"文件最大为10M",type:"warning"}),!1)},handleSuccess:function(e){var t=e.results,a=e.header;this.fileAddress=this.$refs.uploadBox.fileAddress,console.log("文件内容",this.fileAddress),this.tableData=t,this.tableHeader=a,this.total=this.tableData.length,this.list=this.tableData.slice(0,8)}}},v=m,y=Object(d["a"])(v,n,i,!1,null,null,null);t["default"]=y.exports},2:function(e,t){},2350:function(e,t,a){},3:function(e,t){},"333d":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[a("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},i=[];a("c5f6");Math.easeInOutQuad=function(e,t,a,n){return e/=n/2,e<1?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t)};var o=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function s(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function l(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function r(e,t,a){var n=l(),i=e-n,r=20,u=0;t="undefined"===typeof t?500:t;var c=function e(){u+=r;var l=Math.easeInOutQuad(u,n,i,t);s(l),u<t?o(e):a&&"function"===typeof a&&a()};c()}var u={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[8,15,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&r(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&r(0,800)}}},c=u,d=(a("f959"),a("2877")),p=Object(d["a"])(c,n,i,!1,null,"f7df7540",null);t["a"]=p.exports},c1a9:function(e,t,a){},ea2c:function(e,t,a){"use strict";var n=a("2350"),i=a.n(n);i.a},f959:function(e,t,a){"use strict";var n=a("c1a9"),i=a.n(n);i.a}}]);